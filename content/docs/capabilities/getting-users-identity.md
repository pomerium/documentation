---
# cSpell:ignore ecparam genkey noout pubout secp256r1 QCN7adG2AmIK3UdHJvVJkldsUc6XeBRz83Z4rXX8Va4 ary66nrvA55TpaiWADq8b3O1CYIbvjqIHpXCY

title: JWT Authentication
description: Learn how Pomerium supports single sign-on (SSO) and identity verification with JWT authentication and signed HTTP headers.
sidebar_label: JWT Authentication
keywords: [jwt assertion header, jwt authentication, jwt, single sign-on, sso, identity verification, request verification, pomerium jwt, jwt validation, jwt claims]
---

import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem'; import GoApp from '../../examples/go-sdk/go-app.md'; import ReactApp from '../../examples/js-sdk/react-app.md';

# JWT Authentication

This document describes how Pomerium supports JWT authentication in upstream services with JSON web tokens (JWTs).

<iframe
  width="100%"
  height="415"
  src="https://www.youtube.com/embed/mc9USXDiCmk"
  title="YouTube video player"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  allowfullscreen></iframe>

## Overview

JWTs provide a secure and efficient means to authenticate and authorize users before they can access upstream services behind Pomerium. When configured for JWT authentication, Pomerium sends its own JWT to the upstream service. By verifying the Pomerium JWT, the upstream service can:
- Confirm that the Pomerium Proxy service handled the client request before forwarding it. (This capability offers an easy alternative to [client-side mTLS](/docs/capabilities/mtls-clients), which can be difficult to configure depending on your infrastucture or environment.)
- Make application-level authorization decisions based on the user's associated identity information. 

## Why JWT authentication?

### Identity verification

JWT authentication through Pomerium enables an upstream service to verify a user's identity based on claims contained in the JWT. Pomerium signs and issues a new JWT based on the ID token received from the service's configured identity provider, so the upstream service can verify that the claims were not modified in transit.

### Request verification

Pomerium places the newly minted JWT in a [JWT assertion header](#jwt-assertion-header). The presence of the JWT assertion header confirms that the request originated from Pomerium, where the user was authenticated and the request was authorized in accordance with the route's authorization policy.

:::caution JWT validation conditions

If you configure Pomerum for JWT authentication, the upstream service should only accept an incoming request if it satisfies all [**JWT validation**](#jwt-validation) conditions.

:::

### Single Sign-on (SSO)

You can configure upstream services to accept JWTs sent by Pomerium to achieve an SSO authentication flow. This capability is completely free and relatively easy to configure depending on the upstream service and your [identity provider](/docs/identity-providers).

:::info Implement SSO with Pomerium

See our [**Grafana**](/docs/guides/grafana) guide for a real-world example of how configuring both Pomerium and and an upstream service can provide easy SSO access for your end users.

:::

## JWT authentication flow

![A diagram that shows how Pomerium forwards JWTs to an upstream application](./img/jwt-authn/JWT%20Authentication.svg)

### Identity provider authentication

Pomerium requires users to authenticate against an OIDC-compliant identity provider before authorizing or denying a request to an upstream service.

After successful authentication, Pomerium mints a new [**Pomerium JWT**](#pomerium-jwt) based on the **ID token** generated by the identity provider. (This is Pomerium's default behavior, even if you haven't configured Pomerium to support JWT authentication.)

### JWT assertion header

Pomerium signs the Pomerium JWT with a private [signing key](/docs/reference/signing-key) on behalf of the user, and places the JWT into a special HTTP header called the JWT assertion header. Pomerium includes the JWT assertion header in every request it forwards to the upstream service.

:::info JWT assertion header field

The JWT assertion header is a proprietay HTTP header field that follows the format `X-Pomerium-Jwt-Assertion` in a given request.

:::

### JWT validation

The upstream service receives the `X-Pomerium-Jwt-Assertion-Header` with the encrypted JWT. To validate a JWT, the service should check the following items:

- [JWT signature](#jwt-signature)
- [Audience (`aud`) and issuer (`iss`) claims](#aud-and-iss-claims)
- [JWT timestamps](#jwt-timestamps)

#### JWT signature

The upstream service should validate that the JWT was signed by the issuing authority.

Validating the JWT signature requires fetching the corresponding public key from the [**JSON web key set**](https://datatracker.ietf.org/doc/html/rfc8414#section-2) (JWKS) endpoint. The JWKS endpoint is reachable from any Pomerium-managed route domain at `/.well-known/pomerium/jwks.json`.

For example:

<Tabs>
<TabItem label="Hosted Authenticate" value="hosted-authenticate">

:::note

When using the [**hosted authenticate service**](/docs/capabilities/hosted-authenticate-service), use the route domain to fetch the JWKS key.

:::

```bash
curl https://service.corp.example.com/.well-known/pomerium/jwks.json | jq
```

</TabItem>
<TabItem label="Self-hosted Authenticate" value="self-hosted-authenticate">

```bash
curl https://<AUTHENTICATE-SERVICE-URL>/.well-known/pomerium/jwks.json | jq
```

</TabItem>
</Tabs>

A successful request returns a JSON object describing the signing key. The `kid` parameter contains the signing key ID, which is used to calculate the corresponding public key.

```json title="JWKS response"
{
  "keys": [
    {
      "use": "sig",
      "kty": "EC",
      // highlight-start
      "kid": "ccc5bc9d835ff3c8f7075ed4a7510159cf440fd7bf7b517b5caeb1fa419ee6a1",
      // highlight-end
      "crv": "P-256",
      "alg": "ES256",
      "x": "QCN7adG2AmIK3UdHJvVJkldsUc6XeBRz83Z4rXX8Va4",
      "y": "PI95b-ary66nrvA55TpaiWADq8b3O1CYIbvjqIHpXCY"
    }
  ]
}
```

If the JWT signature can't be validated, the JWT is invalid and can't be trusted.

#### Aud and iss claims

The upstream service should verify that the `aud` and `iss` claims match the domain used to serve your application.

The `aud` claim identifies the recipient the JWT is intended for. In the context of a service behind Pomerium, the `aud` claim should always be set as the upstream service's domain name.

Since v0.22, Pomerium sets the `iss` claim also to the domain of the target upstream service. (In previous versions, this was instead set to the authentication service domain.)

If the domain provided in the `aud` and `iss` claims doesn't match the upstream service's domain name, the JWT is invalid and can't be trusted.

```json title="Valid aud and iss claims"
{
  "aud": "verify.pomerium.app",
  "iss": "verify.pomerium.app"
}
```

#### JWT timestamps

The upstream service should verify that the Pomerium JWT has not expired.

The `iat` claim informs you at what time the JWT was issued. The `exp` claim specifies the expiration time on or after which the JWT must be considered invalid. By default, Pomerium sets the `exp` claim to expire 5 minutes after the time it was issued.

By comparing the current time with the timestamps in the `exp` and `iat` claims, you can verify if the JWT has expired or not. We recommend allowing up to a 1-minute leeway when comparing the `exp` and `iat` timestamps to account for [clock skew](https://en.wikipedia.org/wiki/Clock_skew) between Pomerium and the upstream service.

If the JWT has expired, it is invalid and can't be trusted.

:::tip JWT Verification with Pomerium SDKs

Pomerium's [**JWT Verification**](/docs/guides/verify-jwt) guide shows you how to use our custom JWT libraries to parse and validate the Pomerium JWT in an upstream service.

:::

After the upstream service validates the JWT, it can accept the JWT and the request.

## The Pomerium JWT

Pomerium generates a new **Pomerium JWT** based on the claims data contained in the original ID token. In addition to including standard claims as defined in [RFC 7519](https://datatracker.ietf.org/doc/html/rfc7519#section-4.1), Pomerium also injects its own claims into the Pomerium JWT as well. (See [JWT claims data](#jwt-claims-data) below for more details.)

:::note

The original ID token sourced from an identity provider is never modified or leaked to end users or upstream services.

:::

### Pomerium JWT claims data

When Pomerium is configured for JWT authentication, the user's associated identity information will be included in the JWT assertion header in each upstream request. (The signed Pomerium JWT is also available at the special `/.pomerium/jwt` endpoint of any URL handled by Pomerium.)

The Pomerium JWT contains at least the following claims:

| JWT Claim | Description |
| :-: | --- |
| `jti` | A randomly generated UUID that represents the JWT ID. |
| `exp` | Expiration time in seconds since the UNIX epoch. Set to expire 5 minutes after `iat` time. |
| `iat` | Issued-at time in seconds since the UNIX epoch. |
| `aud` | The domain for the upstream application (for example, `httpbin.corp.example.com`). |
| `iss` | Same as the `aud` claim. |
| `sub` | The user's ID, as specified by the identity provider. |
| `email` | The user's email address. |
| `groups` | The user's group memberships (if supported for the identity provider). |
| `name` | The user's full name, as specified by the identity provider. |

### JWT Settings

Use these settings to configure Pomerium to forward the Pomerium JWT to upstream services:

- [Pass Identity Headers (global)](/docs/reference/pass-identity-headers)
- [Pass Identity Headers (per route)](/docs/reference/routes/pass-identity-headers-per-route)

If your identity provider provides other claims not included in the Pomerium JWT that you would like to pass to your application, you can use the [JWT Claims Headers](/docs/reference/jwt-claim-headers) option to include them in the JWT as well.
